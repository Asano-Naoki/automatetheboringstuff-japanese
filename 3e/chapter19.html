<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link href="style.css" rel="stylesheet" type="text/css" /><title>Pythonで退屈な作業を自動化する
</title></head><body><div type="frontmatter" class="calibre" id="calibre_link-0">






<div type="bodymatter" class="calibre" id="calibre_link-499">
<section type="chapter" role="doc-chapter" aria-labelledby="ch19">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1976" aria-label="459"></span>
<hgroup>
<h2 class="title" id="calibre_link-1977">
<span class="tpt"><span class="sans_dogma_ot_bold_b_">19</span></span> <span class="ct"><span class="sans_dogma_ot_bold_b_">日時、スケジュール、プログラムの起動</span></span>
</h2>
</hgroup>
<figure class="opener"><img class="opener1" src="images/000112.jpg" role="presentation" alt="" />
</figure>
<p class="introtni">自分がコンピュータの前に座っていればプログラムを実行するのは簡単ですが、直接監督せずにプログラムを実行できると便利な場合があります。コンピュータの時計でプログラム実行をスケジューリングでき、指定した日時や一定の間隔でコードを実行できます。例えば、変更がないか毎時ウェブサイトをスクレイピングしたり、CPU負荷の高い作業を就寝中の午前4時に行ったりすることができます。Pythonの<span class="sans_thesansmonocd_w5regular_">time</span>モジュールと<span class="sans_thesansmonocd_w5regular_">datetime</span>モジュールを活用します。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">subprocess</span>モジュールを使うと、他のプログラムを起動することもできます。すでに誰かが作ってくれたアプリケーションを活用するのが目的を達成する近道であることが多いです。</p>
<section type="division" aria-labelledby="sec1">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-992" aria-label="460"></span>
<h3 class="h" id="calibre_link-1978"><span id="calibre_link-500"></span><span class="sans_futura_std_bold_b_">timeモジュール</span></h3>
<p class="tni">コンピュータのシステムクロックは特定のタイムゾーンの時刻を指し示しています。Pythonに同梱されている<span class="thesansmonocd_w5regular_">time</span>モジュールを使うと、Pythonプログラムからシステムクロックの現在時刻を読み取れます。このモジュールでよく使う関数は、エポック秒と呼ばれる値を返す<span class="thesansmonocd_w5regular_">time.time()</span>と、プログラムを停止させる<span class="thesansmonocd_w5regular_">time.sleep()</span>です。</p>
<section type="division" aria-labelledby="sec2">
<h4 class="h1" id="calibre_link-1979"><span id="calibre_link-501"></span><span class="sans_futura_std_heavy_oblique_bi_">エポック秒</span></h4>
<p class="tni">プログラミングでは、<i class="calibre5">Unixエポック</i>がよく用いられます。Unixエポックとは、UTC（協定世界時）での1970年1月1日午前0時0分0秒のことです。<span class="thesansmonocd_w5regular_">time.time()</span>関数はUnixエポックからの経過秒数を浮動小数点数値で返します。この数値は<i class="calibre5">エポック秒</i>と呼ばれます。対話型シェルで次のように入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import time</b>
&gt;&gt;&gt; <b class="calibre10">time.time()</b>
1773813875.3518236
</code></pre>
<p class="tx">2026年3月17日午後11時04分に太平洋標準時で<span class="thesansmonocd_w5regular_">time.time()</span>を呼び出しました。返り値はUnixエポックから<span class="thesansmonocd_w5regular_">time.time()</span>が呼び出された瞬間までに経過した秒数です。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">time.time()</span>の返り値は役に立ちますが、人間にはわかりづらいです。<span class="thesansmonocd_w5regular_">time.ctime()</span>関数は現在時刻を表す文字列を返します。<span class="thesansmonocd_w5regular_">time.time()</span>の返り値など、Unixエポックからの経過秒数を渡してその時刻の文字列を取得することもできます。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import time</b>
&gt;&gt;&gt; <b class="calibre10">time.ctime()</b>
'Tue Mar 17 11:05:38 2026'
&gt;&gt;&gt; <b class="calibre10">this_moment = time.time()</b>
&gt;&gt;&gt; <b class="calibre10">time.ctime(this_moment)</b>
'Tue Mar 17 11:05:45 2026'
</code></pre>
<p class="tx">エポック秒はコードの<i class="calibre5">プロファイリング</i>に使えます。一連のコードの実行にどれくらいの時間がかかるかを測定できます。測定したいコードブロックの最初と最後で<span class="thesansmonocd_w5regular_">time.time()</span>を呼び出して引き算をすれば、そのコードブロックに要した時間がわかります。例えば、新しいファイルエディタのタブを開いて、次のプログラムを入力してください。</p>
<pre class="pre"><code class="calibre9"># 100,000個の数値をかけ算するのにかかる時間を測定する
import time
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> def calculate_product():
    # 最初の100,000個の数値をかけ算する
    product = 1
    for i in range(1, 100001):
        product = product * i
    return product

<span role="doc-pagebreak" type="pagebreak" id="calibre_link-960" aria-label="461"></span><span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> start_time = time.time()
result = calculate_product()
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> end_time = time.time()
<span class="codeannotated_codeannotation" aria-label="annotation4">❹</span> print(f'It took {end_time – start_time} seconds to calculate.')
</code></pre>
<p class="tx"><span class="codeannotation" aria-label="annotation1">❶</span>で1から100,000までの整数のかけ算をする<span class="thesansmonocd_w5regular_">calculate_product()</span>という関数を定義しています。<span class="codeannotation" aria-label="annotation2">❷</span>で<span class="thesansmonocd_w5regular_">time.time()</span>を呼び出し、返り値を<span class="thesansmonocd_w5regular_">start_time</span>に格納します。その直後で<span class="thesansmonocd_w5regular_">calculate_product()</span>を呼び出してから、もう一度<span class="thesansmonocd_w5regular_">time.time()</span>を呼び出して返り値を<span class="thesansmonocd_w5regular_">end_time</span>に格納します(<span class="codeannotation" aria-label="annotation3">❸</span>)。<span class="thesansmonocd_w5regular_">calculate_product()</span>を実行するのに要した時間を表示して終了します(<span class="codeannotation" aria-label="annotation4">❹</span>)。</p>
<p class="tx">このプログラムを<i class="calibre5">calcProd.py</i>という名前で保存して実行してみてください。出力は次のようになります。</p>
<pre class="pre"><code class="calibre9">It took 2.844162940979004 seconds to calculate.</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">cProfile.run()</span>を使ってコードプロファイリングをすることもでき、単純な<span class="thesansmonocd_w5regular_">time.time()</span>よりも詳細な情報が得られます。私の別の本である<i class="calibre5">Beyond the Basic Stuff with Python</i> (No Starch Press, 2020)の第13章で<span class="thesansmonocd_w5regular_">cProfile.run()</span>関数について説明しています。</p>
</section>
<section type="division" aria-labelledby="sec3">
<h4 class="h1" id="calibre_link-1980"><span id="calibre_link-502"></span><span class="sans_futura_std_heavy_oblique_bi_">プログラムの停止</span></h4>
<p class="tni">プログラムをしばらく停止させる必要があれば、<span class="thesansmonocd_w5regular_">time.sleep()</span>を呼び出して停止させたい秒数を渡します。対話型シェルで次のように入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import time</b>
&gt;&gt;&gt; <b class="calibre10">for i in range(3):</b>
...   <span class="code_codeannotation" aria-label="annotation1">❶</span> <b class="calibre10">print('Tick')</b>
...   <span class="code_codeannotation" aria-label="annotation2">❷</span> <b class="calibre10">time.sleep(1)</b>
...   <span class="code_codeannotation" aria-label="annotation3">❸</span> <b class="calibre10">print('Tock')</b>
...   <span class="code_codeannotation" aria-label="annotation4">❹</span> <b class="calibre10">time.sleep(1)</b>
...
Tick
Tock
Tick
Tock
Tick
Tock
<span class="codeannotated_codeannotation" aria-label="annotation5">❺</span> &gt;&gt;&gt; <b class="calibre10">time.sleep(5)</b>
&gt;&gt;&gt;
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">for</span>ループでは、<span class="thesansmonocd_w5regular_">Tick</span>を表示して(<span class="codeannotation" aria-label="annotation1">❶</span>)、1秒停止し(<span class="codeannotation" aria-label="annotation2">❷</span>)、<span class="thesansmonocd_w5regular_">Tock</span>を表示して(<span class="codeannotation" aria-label="annotation3">❸</span>)、1秒停止して(<span class="codeannotation" aria-label="annotation4">❹</span>)、<span class="thesansmonocd_w5regular_">Tick</span>を表示して…と、<span class="thesansmonocd_w5regular_">Tick</span>と<span class="thesansmonocd_w5regular_">Tock</span>が3回ずつ表示されるまで続きます。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">time.sleep()</span>関数は渡した秒数が経過するまでブロックします（プログラムのその次のコードは実行されません）。例えば、<span class="thesansmonocd_w5regular_">time.sleep(5)</span>と入力したら(<span class="codeannotation" aria-label="annotation5">❺</span>)、次のプロンプト（<span class="thesansmonocd_w5regular_">&gt;&gt;&gt;</span>）は5秒経過するまで表示されません。</p>
<p class="ph"><span id="calibre_link-503"></span><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1211" aria-label="462"></span><span class="sans_futura_std_heavy_b_">プロジェクト14：スーパーストップウォッチ</span></p>
<p class="tni">まだ自動化していない退屈な作業にどれくらい時間がかかっているかを測定したいとしましょう。物理的なストップウォッチは持っておらず、広告が表示されずブラウザの閲覧履歴を送信しない無料のストップウォッチアプリを見つけるのは難しいです（アプリの利用時に同意すればブラウザの閲覧履歴が送信されます）。Pythonで単純なストップウォッチプログラムを書くことができます。</p>
<p class="tx">このプログラムには以下の内容が必要です。</p>
<ul class="ul">
<li class="bl">プログラムの開始時とラップの開始時に、<span class="thesansmonocd_w5regular_">time.time()</span>を呼び出して現在時刻を取得して保存する</li>
<li class="bl"><small class="calibre4">ENTER</small>が押されたらラップカウンターを1増やす</li>
<li class="bl">エポック秒の引き算をして経過時間を計算する</li>
<li class="bl"><span class="thesansmonocd_w5regular_">KeyboardInterrupt</span>例外を処理して<small class="calibre4">CTRL</small>-Cが押されたら終了するようにする</li>
</ul>
<p class="tx">新しいファイルエディタタブを開き、<i class="calibre5">stopwatch.py</i>という名前で保存してください。</p>
</section>
<section type="division" aria-labelledby="sec4">
<h4 class="h1" id="calibre_link-1981"><span id="calibre_link-504"></span><span class="sans_futura_std_heavy_oblique_bi_">ステップ1：プログラムのセットアップ</span></h4>
<p class="tni">ストップウォッチプログラムは現在時刻を利用するので、<span class="thesansmonocd_w5regular_">time</span>モジュールをインポートします。簡単な説明を表示してから、ユーザーが<small class="calibre4">ENTER</small>を押したときにタイマーが開始するように<span class="thesansmonocd_w5regular_">input()</span>を呼び出します。コードはユーザーが<small class="calibre4">ENTER</small>を押すたびにラップタイムを計算し、<small class="calibre4">CTRL</small>-Cを押すと終了します。</p>
<p class="tx">以下のコードをファイルエディタに書いて、コードの残りの部分については<span class="thesansmonocd_w5regular_">TODO</span>コメントを書きます。</p>
<pre class="pre"><code class="calibre9"># 単純なストップウォッチプログラム
import time

# プログラムの説明を表示
print('Press ENTER to begin and to mark laps. Ctrl-C quits.')
input()  # Enterを押して開始
print('Started.')
start_time = time.time()  # 最初のラップの開始時刻を取得
last_time = start_time
lap_number = 1

# TODO：ラップタイムの測定開始
</code></pre>
<p class="tx">説明を表示して、最初のラップを開始して時刻を保存し、<span class="thesansmonocd_w5regular_">lap_number</span>を1に設定するコードを書きました。</p>
</section>
<section type="division" aria-labelledby="sec5">
<h4 class="h1" id="calibre_link-1982"><span id="calibre_link-505"></span><span class="sans_futura_std_heavy_oblique_bi_">ステップ2：ラップタイムの測定と表示</span></h4>
<p class="tni">新しいラップを開始して、前のラップの時間を計算し、ストップウォッチを開始してからの総経過時間を計算するコードを書きましょう。新しいラップを開始するごとに、ラップタイムとトータルタイムを表示して、ラップカウントを1増やします。以下のコードを追記してください。</p>
<pre class="pre"><code class="calibre9"># 単純なストップウォッチプログラム
import time

<var class="calibre20">--snip--</var>

<b class="calibre10"># ラップタイムの測定開始</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> <b class="calibre10">try:</b>
  <span class="code_codeannotation" aria-label="annotation2">❷</span> <b class="calibre10">while True:</b>
        <b class="calibre10">input()</b>
      <span class="code_codeannotation" aria-label="annotation3">❸</span> <b class="calibre10">lap_time = round(time.time() – last_time, 2)</b>
      <span class="code_codeannotation" aria-label="annotation4">❹</span><b class="calibre10"> total_time = round(time.time() – start_time, 2)</b>
    <b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation5">❺</span><b class="calibre10"> print('Lap #{lap_number}: {total_time}({lap_time})', end='')</b>
<b class="calibre10">        lap_number += 1</b>
<b class="calibre10">        last_time = time.time() </b># 直近のラップタイムをリセット
<span class="codeannotated_codeannotation" aria-label="annotation6">❻</span> <b class="calibre10">except KeyboardInterrupt:</b>
<b class="calibre10">    # Ctrl-C例外を処理してエラーメッセージを表示させない</b>
<b class="calibre10">    print('\nDone.')</b>
</code></pre>
<p class="tx">ストップウォッチを止めるためにユーザーが<small class="calibre4">CTRL</small>-Cを押すと、<span class="thesansmonocd_w5regular_">KeyboardInterrupt</span>例外が送出されてプログラムはクラッシュします。クラッシュしないように、プログラムを<span class="thesansmonocd_w5regular_">try</span>文で囲みます(<span class="codeannotation" aria-label="annotation1">❶</span>)。<span class="thesansmonocd_w5regular_">except</span>節で例外を処理します(<span class="codeannotation" aria-label="annotation6">❻</span>)。例外が送出されたときに、<span class="thesansmonocd_w5regular_">KeyboardInterrupt</span>エラーメッセージではなく<span class="thesansmonocd_w5regular_">Done</span>と表示します。それまでは無限ループ内での実行が続きます(<span class="codeannotation" aria-label="annotation2">❷</span>)。<span class="thesansmonocd_w5regular_">input()</span>を呼び出してユーザーがラップを終わらせるために<small class="calibre4">ENTER</small>を押すまで待ちます。ラップが終われば、<span class="thesansmonocd_w5regular_">time.time()</span>の現在時刻から<span class="thesansmonocd_w5regular_">last_time</span>のラップ開始時刻を引いて、そのラップの時間を計算します(<span class="codeannotation" aria-label="annotation3">❸</span>)。現在時刻から<span class="thesansmonocd_w5regular_">start_time</span>のストップウォッチ開始時刻を引いて、総経過時間を計算します(<span class="codeannotation" aria-label="annotation4">❹</span>)。</p>
<p class="tx">この計算結果には、<span class="thesansmonocd_w5regular_">4.766272783279419</span>のように小数点以下の数字がたくさんあるので、<span class="thesansmonocd_w5regular_">round()</span>関数で小数第二位に丸めます(<span class="codeannotation" aria-label="annotation3">❸</span><span class="codeannotation" aria-label="annotation4">❹</span>)。</p>
<p class="tx"><span class="codeannotation" aria-label="annotation5">❺</span>では、ラップ番号とトータルタイム（総経過時間）とラップタイムを表示します。<span class="thesansmonocd_w5regular_">input()</span>呼び出しに対してユーザーが<small class="calibre4">ENTER</small>を押すと画面が改行されるので、<span class="thesansmonocd_w5regular_">print()</span>関数に<span class="thesansmonocd_w5regular_">end=''</span>を渡して出力が二重に改行されてしまわないようにしています。ラップ情報を表示し、<span class="thesansmonocd_w5regular_">lap_number</span>に1を加え、<span class="thesansmonocd_w5regular_">last_time</span>に現在時刻をセットして、次のラップの準備を行います。これが次のラップの開始時刻です。</p>
</section>
<section type="division" aria-labelledby="sec6">
<h4 class="h1" id="calibre_link-1983"><span id="calibre_link-506"></span><span class="sans_futura_std_heavy_oblique_bi_">似たようなプログラムのアイデア</span></h4>
<p class="tni">時間を測定できるようになれば、プログラムはさまざまな可能性に開かれます。時間を測定するアプリをダウンロードできますが、自分でプログラムを書けばフリー（自由／無料）ですし、広告や不必要な機能に悩まされることもありません。以下のようなプログラムを作成できます。</p>
<ul class="ul">
<li class="bl">従業員の名前を入力すると出退勤時刻が入力される単純な勤怠管理アプリ</li>
<li class="bl"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1094" aria-label="464"></span>第13章で紹介した<span class="thesansmonocd_w5regular_">requests</span>モジュールを使ってダウンロードするアプリへの経過時間の表示の追加</li>
<li class="bl">プログラムの実行時間をチェックして、あまりにも長く時間がかかっている作業をキャンセルできるようにする機能</li>
</ul>
</section>
</section>
<section type="division" aria-labelledby="sec7">
<h3 class="h" id="calibre_link-1984"><span id="calibre_link-507"></span><span class="sans_futura_std_bold_b_">datetimeモジュール</span></h3>
<p class="tni"><span class="thesansmonocd_w5regular_">time</span>モジュールを使えばエポック秒を取得できます。しかし、日付をもっと見やすく表示したかったり、日付の計算をしたかったりしたら（例えば今日から205日前や123日後を知りたい場合など）、<span class="thesansmonocd_w5regular_">datetime</span>モジュールを使ったほうがよいです。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">datetime</span>モジュールには<span class="thesansmonocd_w5regular_">datetime</span>データ型があります。<span class="thesansmonocd_w5regular_">datetime</span>値は特定の時点を表しています。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">datetime.datetime.now()</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> datetime.datetime(2026, 2, 27, 11, 10, 49, 727297)
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> &gt;&gt;&gt; <b class="calibre10">dt = datetime.datetime(2026, 10, 21, 16, 29, 0)</b>
<span class="codeannotated_codeannotation" aria-label="annotation4">❹</span> &gt;&gt;&gt; <b class="calibre10">dt.year, dt.month, dt.day</b>
(2026, 10, 21)
<span class="codeannotated_codeannotation" aria-label="annotation5">❺</span> &gt;&gt;&gt; <b class="calibre10">dt.hour, dt.minute, dt.second</b>
(16, 29, 0)
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">datetime.datetime.now()</span>を呼び出すと(<span class="codeannotation" aria-label="annotation1">❶</span>)、コンピュータの時計に基づいた現在時刻の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトが返されます(<span class="codeannotation" aria-label="annotation2">❷</span>)。このオブジェクトには、年、月、日、時、分、秒、マイクロ秒が含まれています。<span class="thesansmonocd_w5regular_">datetime.datetime()</span>関数を使えば(<span class="codeannotation" aria-label="annotation3">❸</span>)、指定した時点の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得できます。年、月、日、時、分、秒を整数で渡します。この整数は、<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトの属性<span class="thesansmonocd_w5regular_">year</span>、<span class="thesansmonocd_w5regular_">month</span>、<span class="thesansmonocd_w5regular_">day</span>(<span class="codeannotation" aria-label="annotation4">❹</span>)、<span class="thesansmonocd_w5regular_">hour</span>、<span class="thesansmonocd_w5regular_">minute</span>、<span class="thesansmonocd_w5regular_">second</span>(<span class="codeannotation" aria-label="annotation5">❺</span>)に格納されます。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">datetime.datetime.fromtimestamp()</span>関数でエポック秒を<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトに変換できます。<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトの日時はローカルタイムゾーンに変換されます。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime, time</b>
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.fromtimestamp(1000000)</b>
datetime.datetime(1970, 1, 12, 5, 46, 40)
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.fromtimestamp(time.time())</b>
datetime.datetime(2026, 10, 21, 16, 30, 0, 604980)
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">1000000</span>を渡して<span class="thesansmonocd_w5regular_">datetime.datetime.fromtimestamp()</span>を呼び出すと、Unix時間から1,000,000秒経過した瞬間の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトが返されます。<span class="thesansmonocd_w5regular_">time.time()</span>は、現在時刻のエポック秒を返しますから、これを渡すと現在時刻の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトが返されます。つまり、<span class="thesansmonocd_w5regular_">datetime.datetime.now()</span>と<span class="thesansmonocd_w5regular_">datetime.datetime.fromtimestamp(time.time())</span>は同じことをしています。どちらでも現在時刻の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得できます。</p>
<p class="tx">比較演算子で<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを比較して、日時の先後を判定できます。遅い<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトが「大きい」値です。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">halloween_2026 = datetime.datetime(2026, 10, 31, 0, 0, 0)</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> &gt;&gt;&gt; <b class="calibre10">new_years_2027 = datetime.datetime(2027, 1, 1, 0, 0, 0)</b>
&gt;&gt;&gt; <b class="calibre10">oct_31_2026 = datetime.datetime(2026, 10, 31, 0, 0, 0)</b>
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> &gt;&gt;&gt; <b class="calibre10">halloween_2026 == oct_31_2026</b>
True
<span class="codeannotated_codeannotation" aria-label="annotation4">❹</span> &gt;&gt;&gt; <b class="calibre10">halloween_2026 &gt; new_years_2027</b>
False
<span class="codeannotated_codeannotation" aria-label="annotation5">❺</span> &gt;&gt;&gt; <b class="calibre10">new_years_2027 &gt; halloween_2026</b>
True
&gt;&gt;&gt; <b class="calibre10">new_years_2027 != oct_31_2026</b>
True
</code></pre>
<p class="tx">このコードでは、2026年10月31日午前0時0分0秒の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを作成して<span class="thesansmonocd_w5regular_">halloween_2026</span>に格納しています(<span class="codeannotation" aria-label="annotation1">❶</span>)。次に、2027年1月1日午前0時0分0秒の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを作成して<span class="thesansmonocd_w5regular_">new_years_2027</span>に格納しています(<span class="codeannotation" aria-label="annotation2">❷</span>)。さらに、2026年10月31日午前0時0分0秒の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトをもう一つ作成して<span class="thesansmonocd_w5regular_">oct_31_2026</span>に格納しています。<span class="thesansmonocd_w5regular_">halloween_2026</span>と<span class="thesansmonocd_w5regular_">oct_31_2026</span>を比較すると、等しいと判定されます(<span class="codeannotation" aria-label="annotation3">❸</span>)。<span class="thesansmonocd_w5regular_">new_years_2027</span>と<span class="thesansmonocd_w5regular_">halloween_2026</span>を比較すると、<span class="thesansmonocd_w5regular_">new_years_2027</span>のほうが<span class="thesansmonocd_w5regular_">halloween_2026</span>よりも大きい（遅い）と判定されます(<span class="codeannotation" aria-label="annotation4">❹</span><span class="codeannotation" aria-label="annotation5">❺</span>)。</p>
<section type="division" aria-labelledby="sec8">
<h4 class="h1" id="calibre_link-1985"><span id="calibre_link-508"></span><span class="sans_futura_std_heavy_oblique_bi_">期間</span></h4>
<p class="tni"><span class="thesansmonocd_w5regular_">datetime</span>モジュールには<span class="thesansmonocd_w5regular_">timedelta</span>というデータ型もあります。これは瞬間的な時刻ではなく、幅のある期間を表します。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">delta = datetime.timedelta(days=11, hours=10, minutes=9, seconds=8)</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> &gt;&gt;&gt; <b class="calibre10">delta.days, delta.seconds, delta.microseconds</b>
(11, 36548, 0)
&gt;&gt;&gt; <b class="calibre10">delta.total_seconds()</b>
986948.0
&gt;&gt;&gt; <b class="calibre10">str(delta)</b>
'11 days, 10:09:08'
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">datetime.timedelta()</span>関数で<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを作成します。<span class="thesansmonocd_w5regular_">datetime.timedelta()</span>関数は、<span class="thesansmonocd_w5regular_">weeks</span>、<span class="thesansmonocd_w5regular_">days</span>、<span class="thesansmonocd_w5regular_">hours</span>、<span class="thesansmonocd_w5regular_">minutes</span>、<span class="thesansmonocd_w5regular_">seconds</span>、<span class="thesansmonocd_w5regular_">milliseconds</span>、<span class="thesansmonocd_w5regular_">microseconds</span>のキーワード引数を取ります。<span class="thesansmonocd_w5regular_">month</span>と<span class="thesansmonocd_w5regular_">year</span>のキーワード引数はありません。なぜなら月や年の期間は一定ではないからです。<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトは、日、秒、マイクロ秒の合計で期間を表します。それぞれ、<span class="thesansmonocd_w5regular_">days</span>、<span class="thesansmonocd_w5regular_">seconds</span>、<span class="thesansmonocd_w5regular_">microseconds</span>属性に格納されています。<span class="thesansmonocd_w5regular_">total_seconds()</span>メソッドは秒単位での期間を返します。<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを<span class="thesansmonocd_w5regular_">str()</span>に渡すと、人間にとって読みやすい形式で表された文字列が返されます。</p>
<p class="tx">この例では、<span class="thesansmonocd_w5regular_">datetime.delta()</span>に11日10時間9分8秒間の期間を指定するキーワード引数を渡し、返り値の<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを<span class="thesansmonocd_w5regular_">delta</span>に格納しています(<span class="codeannotation" aria-label="annotation1">❶</span>)。この<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトの<span class="thesansmonocd_w5regular_">days</span>属性には<span class="thesansmonocd_w5regular_">11</span>が格納され、<span class="thesansmonocd_w5regular_">seconds</span>属性には<span class="thesansmonocd_w5regular_">36548</span>（10時間9分8秒を秒で表したもの）が格納されます(<span class="codeannotation" aria-label="annotation2">❷</span>)。<span class="thesansmonocd_w5regular_">total_seconds()</span>を呼び出すと、11日10時間9分8秒間は986,948秒間であることがわかります。最後に、<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを<span class="thesansmonocd_w5regular_">str()</span>に渡して、その期間をわかりやすい文字列にしています。</p>
<p class="tx">算術演算子を使って<span class="thesansmonocd_w5regular_">datetime</span>値について<i class="calibre5">日付計算</i>を行うことができます。例えば、今から1,000日後を計算するには、対話型シェルに以下のように入力します。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime</b>
&gt;&gt;&gt; <b class="calibre10">now = datetime.datetime.now()</b>
&gt;&gt;&gt; <b class="calibre10">now</b>
datetime.datetime(2026, 12, 2, 18, 38, 50, 636181)
&gt;&gt;&gt; <b class="calibre10">thousand_days = datetime.timedelta(days=1000)</b>
&gt;&gt;&gt; <b class="calibre10">now + thousand_days</b>
datetime.datetime(2029, 8, 28, 18, 38, 50, 636181)
</code></pre>
<p class="tx">まず、現在時刻の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを作成して<span class="thesansmonocd_w5regular_">now</span>に格納します。次に、1,000日間を表す<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを作成して<span class="thesansmonocd_w5regular_">thousand_days</span>に格納します。<span class="thesansmonocd_w5regular_">now</span>と<span class="thesansmonocd_w5regular_">thousand_days</span>を足し合わせ、<span class="thesansmonocd_w5regular_">now</span>の現在時刻から1,000日後の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得します。Pythonが計算をしてくれて、2026年12月2日の1,000日後は2029年8月28日だとわかります。1,000日後を計算するには、各月の日数に基づきうるう年を考慮するなどしなければなりませんが、<span class="thesansmonocd_w5regular_">datetime</span>モジュールはうまく処理してくれます。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを使えば、<span class="thesansmonocd_w5regular_">+</span>と<span class="thesansmonocd_w5regular_">-</span>の演算子で、<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトや別の<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトと足し引きできます。<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトは<span class="thesansmonocd_w5regular_">*</span>と<span class="thesansmonocd_w5regular_">/</span>の演算子で整数や小数のかけ算や割り算ができます。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import datetime</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">oct_21st = datetime.datetime(2026, 10, 21, 16, 29, 0)</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> &gt;&gt;&gt; <b class="calibre10">about_thirty_years = datetime.timedelta(days=365 * 30)</b>
&gt;&gt;&gt; <b class="calibre10">oct_21st</b>
datetime.datetime(2026, 10, 21, 16, 29)
&gt;&gt;&gt; <b class="calibre10">oct_21st – about_thirty_years</b>
datetime.datetime(1996, 10, 28, 16, 29)
&gt;&gt;&gt; <b class="calibre10">oct_21st - (2 * about_thirty_years)</b>
datetime.datetime(1966, 11, 5, 16, 29)
</code></pre>
<p class="tx">2026年10月21日を表す<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを作成し(<span class="codeannotation" aria-label="annotation1">❶</span>)、約30年間の期間を表す<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを作成しています(<span class="codeannotation" aria-label="annotation2">❷</span>)。（毎年365日と考えてうるう年は考慮に入れていません。）<span class="thesansmonocd_w5regular_">oct_21st</span>から<span class="thesansmonocd_w5regular_">about_thirty_years</span>を引くと、2026年10月21日から約30年前の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得できます。<span class="thesansmonocd_w5regular_">oct_21st</span>から<span class="thesansmonocd_w5regular_">2 * about_thirty_years</span>を引くと、1966年11月5日の夕方という、約60年前の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得できます。</p>
</section>
<section type="division" aria-labelledby="sec9">
<h4 class="h1" id="calibre_link-1986"><span id="calibre_link-509"></span><span class="sans_futura_std_heavy_oblique_bi_">指定した日時まで停止させる</span></h4>
<p class="tni"><span class="thesansmonocd_w5regular_">time.sleep()</span>メソッドは指定した秒数だけプログラムを停止させます。<span class="thesansmonocd_w5regular_">while</span>ループを活用すると、プログラムを指定した日時まで停止させられます。例えば、以下のコードは、2039年のハロウィンまでループし続けます。</p>
<pre class="pre"><code class="calibre9">import datetime
import time
halloween_2039 = datetime.datetime(2039, 10, 31, 0, 0, 0)
while datetime.datetime.now() &lt; halloween_2039:
    time.sleep(1)  # ループしてもう一度判定するまでに1秒待つ
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">time.sleep(1)</span>を呼び出すとPythonプログラムを停止するので、最速でループしてコンピュータがCPUの処理サイクルを無駄にするということはありません。<span class="thesansmonocd_w5regular_">while</span>ループは1秒に1回だけ条件を判定して、2039年のハロウィンになればプログラムの残りの部分に進みます（ここでは2039年のハロウィンにしましたが、プログラムをいつまで停止させるかは自由に決められます）。</p>
</section>
<section type="division" aria-labelledby="sec10">
<h4 class="h1" id="calibre_link-1987"><span id="calibre_link-510"></span><span class="sans_futura_std_heavy_oblique_bi_">datetimeオブジェクトから文字列への変換</span></h4>
<p class="tni">エポック秒と<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトは人間の目に優しくありません。<span class="thesansmonocd_w5regular_">strftime()</span>メソッドを使えば<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを文字列として表示できます（<span class="thesansmonocd_w5regular_">strftime()</span>関数の名前の中にある<i class="calibre5">f</i>は<i class="calibre5">format</i>の<i class="calibre5">f</i>です。）</p>
<p class="tx"><span class="thesansmonocd_w5regular_">strftime()</span>メソッドはPythonの文字列補間と似た指示子を使います。表19-1は<span class="thesansmonocd_w5regular_">strftime()</span>指示子の全一覧です。この情報は<i class="calibre5"><a href="https://strftime.org" class="calibre1">https://<wbr></wbr>strftime<wbr></wbr>.org</a></i>にも載っています。</p>
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-855" aria-label="468"></span>
<table class="basic-table">
<caption class="calibre12"><p class="tt" id="calibre_link-801"><span class="sans_futura_std_bold_b_"><span class="sans_futura_std_bold_b_">表 19-1：</span></span><span class="thesansmonocd_w5regular_">strftime()</span><span class="sans_futura_std_book_">の指示子</span></p></caption>

<thead class="calibre13">
<tr class="calibre14">
<th class="tch" scope="col"><p class="tch1"><span class="sans_thesansmonocd_w7bold_b_">strftime()の指示子</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_thesansmonocd_w7bold_b_">意味</span></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="calibre16">
<td class="tbf"><p class="tch1"><span class="thesansmonocd_w5regular_">%Y</span></p></td>
<td class="tbf"><p class="tch1"><span class="thesansmonocd_w5regular_">'2026'</span><span class="sans_futura_std_book_">のような4桁の年</span> </p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%y</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'00'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'99'</span><span class="sans_futura_std_book_">までの2桁の年（1970から2069）</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%m</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'01'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'12'</span><span class="sans_futura_std_book_">までの月</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%B</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'November'</span><span class="sans_futura_std_book_">のような月名</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%b</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'Nov'</span><span class="sans_futura_std_book_">のような省略形の月名</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%d</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'01'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'31'</span><span class="sans_futura_std_book_">までの日付</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%j</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'001'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'366'</span><span class="sans_futura_std_book_">までの一年のうちの日</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%w</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'0'</span><span class="sans_futura_std_book_">（日曜日）から</span><span class="thesansmonocd_w5regular_">'6'</span><span class="sans_futura_std_book_">（土曜日）までの曜日</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%A</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'Monday'</span><span class="sans_futura_std_book_">のような曜日名</span> </p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%a</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'Mon'</span><span class="sans_futura_std_book_">のよう省略形の曜日名</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%H</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'00'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'23'</span><span class="sans_futura_std_book_">までの24時間表記の時間</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%I</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'01'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'12'</span><span class="sans_futura_std_book_">までの12時間表記の時間</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%M</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'00'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'59'</span><span class="sans_futura_std_book_">までの分</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%S</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'00'</span><span class="sans_futura_std_book_">から</span><span class="thesansmonocd_w5regular_">'59'</span><span class="sans_futura_std_book_">までの秒</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">%p</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">'AM'（午前）</span><span class="sans_futura_std_book_">または</span><span class="thesansmonocd_w5regular_">'PM'（午後）</span></p></td>
</tr>
<tr class="calibre14">
<td class="tbl"><p class="tch1"><span class="thesansmonocd_w5regular_">%%</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">リテラルな</span><span class="thesansmonocd_w5regular_">'%'</span><span class="sans_futura_std_book_">記号（%文字そのものを表したいときに使う）</span></p></td>
</tr>
</tbody>
</table>
<p class="tx"><span class="thesansmonocd_w5regular_">strftime()</span>にフォーマット指示子を含めてスラッシュやコロンなどでカスタムしたフォーマット文字列を渡します。そうすると<span class="thesansmonocd_w5regular_">strftime()</span>は指定したフォーマットの文字列で<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトの情報を返します。以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">oct_21st = datetime.datetime(2026, 10, 21, 16, 29, 0)</b>
&gt;&gt;&gt; <b class="calibre10">oct_21st.strftime('%Y/%m/%d %H:%M:%S')</b>
'2026/10/21 16:29:00'
&gt;&gt;&gt; <b class="calibre10">oct_21st.strftime('%I:%M %p')</b>
'04:29 PM'
&gt;&gt;&gt; <b class="calibre10">oct_21st.strftime("%B of '%y")</b>
"October of '26"
</code></pre>
<p class="tx">2026年10月21日午後4時29分を表す<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトがあり、<span class="thesansmonocd_w5regular_">oct_21st</span>に格納されています。カスタムしたフォーマット文字列<span class="thesansmonocd_w5regular_">'%Y/%m/%d %H:%M:%S'</span>を<span class="thesansmonocd_w5regular_">strftime()</span>に渡すと、2026と10と21がスラッシュで区切られ、16と29と00がコロンで区切られた文字列が返されます。<span class="thesansmonocd_w5regular_">'%I:%M %p'</span>を渡すと<span class="thesansmonocd_w5regular_">'04:29 PM'</span>が、<span class="thesansmonocd_w5regular_">"%B of '%y"</span>を渡すと<span class="thesansmonocd_w5regular_">"October of '26"</span>が返されます。</p>
</section>
<section type="division" aria-labelledby="sec11">
<h4 class="h1" id="calibre_link-1988"><span id="calibre_link-511"></span><span class="sans_futura_std_heavy_oblique_bi_">文字列からdatetimeオブジェクトへの変換</span></h4>
<p class="tni"><span class="thesansmonocd_w5regular_">'2026/10/21 16:29:00'</span>や<span class="thesansmonocd_w5regular_">'October 21, 2026'</span>のような日時情報の文字列があり、その文字列を<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトに変換したければ、<span class="thesansmonocd_w5regular_">datetime.datetime.strptime()</span>関数が使えます。<span class="thesansmonocd_w5regular_">strptime()</span>関数は<span class="thesansmonocd_w5regular_">strftime()</span>メソッドの逆です。<span class="thesansmonocd_w5regular_">strftime()</span>と同じ指示子でカスタムしたフォーマット文字列を渡すと、文字列を解析してくれます（<span class="thesansmonocd_w5regular_">strptime()</span>関数の名前の中にある<i class="calibre5">p</i>は<i class="calibre5">parse</i>の<i class="calibre5">p</i>です）。</p>
<p class="tx">以下の式を対話型シェルに入力してみてください。</p>
<pre class="pre"><code class="calibre9"><span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">datetime.datetime.strptime('October 21, 2026', '%B %d, %Y')</b>
datetime.datetime(2026, 10, 21, 0, 0)
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.strptime('2026/10/21 16:29:00', '%Y/%m/%d %H:%M:%S')</b>
datetime.datetime(2026, 10, 21, 16, 29)
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.strptime("October of '26", "%B of '%y")</b>
datetime.datetime(2026, 10, 1, 0, 0)
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.strptime("November of '63", "%B of '%y")</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> datetime.datetime(2063, 11, 1, 0, 0)
&gt;&gt;&gt; <b class="calibre10">datetime.datetime.strptime("November of '73", "%B of '%y")</b>
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> datetime.datetime(1973, 11, 1, 0, 0)
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">'October 21, 2026'</span>という文字列から<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトを取得するために、文字列を<span class="thesansmonocd_w5regular_">strptime()</span>の第一引数に渡し、<span class="thesansmonocd_w5regular_">'October 21, 2026'</span>に対応するカスタムしたフォーマット文字列を第二引数に渡しています(<span class="codeannotation" aria-label="annotation1">❶</span>)。日時情報の文字列はカスタムしたフォーマット文字列と正確にマッチしなければなりません。そうでないとPythonは<span class="thesansmonocd_w5regular_">ValueError</span>例外を送出します。<span class="thesansmonocd_w5regular_">%y</span>指示子は1970から2069の間であるため、<span class="thesansmonocd_w5regular_">"November of '63"</span>は2063と解釈されるのに対し(<span class="codeannotation" aria-label="annotation2">❷</span>)、<span class="thesansmonocd_w5regular_">"November of '73"</span>は1973と解釈される(<span class="codeannotation">❸</span>)ことに注意してください。</p>
<aside class="box" aria-label="box-18">
<p class="bt" id="calibre_link-1989"><span class="sans_futura_std_bold_b_">Pythonの時間関数のおさらい</span></p>
<p class="btni"><span class="sans_futura_std_book_">Pythonの日付と時間にはさまざまなデータ型と関数があります。時間を表す3種類の型の値をおさらいします。</span></p>
<ul class="ul">
<li class="boxlistbullet">（<span class="thesansmonocd_w5regular_">time</span><span class="sans_futura_std_book_">モジュールで使用される）エポック秒は、UTCでの1970年1月1日午前0時0分0秒からの経過秒数を表す浮動小数点数値または整数値です。</span></li>
<li class="boxlistbullet"><span class="sans_futura_std_book_">（</span><span class="thesansmonocd_w5regular_">datetime</span>モジュールの）<span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">オブジェクトは、属性</span><span class="thesansmonocd_w5regular_">year</span><span class="sans_futura_std_book_">、</span><span class="thesansmonocd_w5regular_">month</span><span class="sans_futura_std_book_">、</span><span class="thesansmonocd_w5regular_">day</span><span class="sans_futura_std_book_">、</span><span class="thesansmonocd_w5regular_">hour</span><span class="sans_futura_std_book_">、</span><span class="thesansmonocd_w5regular_">minute</span><span class="sans_futura_std_book_">、</span><span class="thesansmonocd_w5regular_">second</span><span class="sans_futura_std_book_">、</span> <span class="thesansmonocd_w5regular_">microsecond</span><span class="sans_futura_std_book_">に整数が格納されています。</span></li>
<li class="boxlistbullet"><span class="sans_futura_std_book_">（</span><span class="thesansmonocd_w5regular_">datetime</span>モジュールの）<span class="thesansmonocd_w5regular_">timedelta</span><span class="sans_futura_std_book_">オブジェクトは時刻ではなく期間を表します。</span></li>
</ul>
<p class="boxb-last"><span class="sans_futura_std_book_">時間関数とそのパラメータおよび返り値についておさらいします。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">time.time()</span><span class="sans_futura_std_book_"> この関数は、現在のエポック秒を浮動小数点数値で返します。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">time.sleep(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">seconds</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この関数は、プログラムを</span> <span class="sans_thesansmonocd_w5regular_italic_">seconds</span><span class="sans_futura_std_book_">引数で指定した秒数だけ停止させます。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">datetime.datetime(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">year, month, day, hour, minute, second</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この関数は、引数で指定した時刻の</span> <span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">オブジェクトを返します。</span><span class="sans_thesansmonocd_w5regular_italic_">hour</span><span class="sans_futura_std_book_">、</span><span class="sans_thesansmonocd_w5regular_italic_">minute</span><span class="sans_futura_std_book_">、</span><span class="sans_thesansmonocd_w5regular_italic_">second</span> <span class="sans_futura_std_book_">の引数は、指定されなければデフォルトで</span><span class="thesansmonocd_w5regular_">0</span><span class="sans_futura_std_book_">になります。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">datetime.datetime.now()</span> <span class="sans_futura_std_book_">この関数は、現在時刻の</span><span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">オブジェクトを返します。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">datetime.datetime.fromtimestamp(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">epoch</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この関数は、</span><span class="sans_thesansmonocd_w5regular_italic_">epoch</span><span class="sans_futura_std_book_">引数で指定したエポック秒の</span><span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">オブジェクトを返します。</span> </p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">datetime.timedelta(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">weeks, days, hours, minutes, seconds, milliseconds, microseconds</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この関数は、期間を表す</span><span class="thesansmonocd_w5regular_">timedelta</span><span class="sans_futura_std_book_">オブジェクトを返します。この関数のキーワード引数はすべてオプションで、</span><span class="sans_thesansmonocd_w5regular_italic_">month</span><span class="sans_futura_std_book_">と</span><span class="sans_thesansmonocd_w5regular_italic_">year</span><span class="sans_futura_std_book_">はありません。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">total_seconds()</span> <span class="sans_futura_std_book_">この</span><span class="thesansmonocd_w5regular_">timedelta</span><span class="sans_futura_std_book_">メソッドは、その</span><span class="thesansmonocd_w5regular_">timedelta</span><span class="sans_futura_std_book_">オブジェクトが表す秒数を返します。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">strftime(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">format</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この</span><span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">メソッドは、</span><span class="sans_thesansmonocd_w5regular_italic_">format</span><span class="sans_futura_std_book_">に基づきカスタムしたフォーマットの時刻の文字列を返します。フォーマットの詳細については表19-1を参照してください。</span></p>
<p class="boxruninpara"><span class="sans_thesansmonocd_w7bold_b_">datetime.datetime.strptime(</span><span class="sans_thesansmonocd_w7bold_italic_bi_">time_string, format</span><span class="sans_thesansmonocd_w7bold_b_">)</span> <span class="sans_futura_std_book_">この関数は、</span><span class="sans_thesansmonocd_w5regular_italic_">time_string</span><span class="sans_futura_std_book_">で指定した時刻を表す</span><span class="thesansmonocd_w5regular_">datetime</span><span class="sans_futura_std_book_">オブジェクトを返します。</span> <span class="sans_thesansmonocd_w5regular_italic_">format</span><span class="sans_futura_std_book_">文字列引数に基づいて解釈します。フォーマットの詳細については表19-1を参照してください。</span></p>
</aside>
</section>
</section>
<section type="division" aria-labelledby="sec12">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1303" aria-label="470"></span>
<h3 class="h" id="calibre_link-1990"><span id="calibre_link-512"></span><span class="sans_futura_std_bold_b_">Pythonから別のプログラムを起動する</span></h3>
<p class="tni">組み込みの<span class="thesansmonocd_w5regular_">subprocess</span>モジュールの<span class="thesansmonocd_w5regular_">run()</span>関数を使えば、Pythonのプログラムからそのコンピュータ上の別のプログラムを開始できます。同じアプリケーションを複数開くと、それぞれ別のプロセスになります。例えば、図19-1は、別々のプロセスで電卓アプリを開いたウィンドウを示しています。</p>
<figure class="img"><img class="img1" id="calibre_link-802" src="images/000047.jpg" alt="Screenshot of a Windows computer desktop showing six overlapping calculator programs" />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">図 19-1：同じ電卓プログラムの6つの実行プロセス</span></p></figcaption>
</figure>
<p class="tx">Pythonスクリプトから外部のプログラムを開始するには、<span class="thesansmonocd_w5regular_">subprocess.run()</span>に起動したいプログラムのファイル名を渡します。（Windowsでは、アプリケーションの<b class="calibre10">スタート</b>メニューを右クリックして<b class="calibre10">プロパティ</b>を選べばそのアプリケーションのファイル名を確認できます。macOSでは、アプリケーションを<small class="calibre4">CTRL</small>-クリックして、<b class="calibre10">パッケージの内容を表示</b>を選べば実行ファイルのパスを確認できます。）<span class="thesansmonocd_w5regular_">run()</span>関数は起動したプログラムが閉じられるまでコードの実行をブロックします。起動するプログラムの実行ファイルのパスをリスト内に文字列で書いて渡します。起動したプログラムは、Pythonプログラムと同じプロセスではなく、別々のプロセスで実行されます。</p>
<p class="tx">Windowsでは、以下の対話型シェルの内容を実行してください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">subprocess.run(['C:\\Windows\\System32\\calc.exe'])</b>
CompletedProcess(args=['C:\\Windows\\System32\\calc.exe'], returncode=0)
</code></pre>
<p class="tx">Ubuntu Linuxでは、以下を実行してください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">subprocess.run(['/usr/bin/gnome-calculator'])</b>
CompletedProcess(args=['/usr/bin/gnome-calculator'], returncode=0)
</code></pre>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1045" aria-label="471"></span>macOSでは、以下を実行してください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">subprocess.run(['open', '/System/Applications/Calculator.app'])</b>
CompletedProcess(args=['open', '/System/Applications/Calculator.app'], returncode=0)
</code></pre>
<p class="tx">macOSでは<span class="thesansmonocd_w5regular_">open</span>プログラムに起動したいプログラムをコマンドライン引数で渡さなければなりません。</p>
<p class="tx">これらの例では、Pythonのコードが指定したプログラムを起動し、そのプログラムが閉じられるまで待ってから、コードの残りの部分を実行します。プログラムを起動してそのプログラムが閉じられるのを待たずにすぐコードの実行を続けたければ、<span class="thesansmonocd_w5regular_">subprocess.Popen()</span> 関数（Popenはprocess openの略）を呼び出します。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">calc_proc = subprocess.Popen(['C:\\Windows\\System32\\calc.exe'])</b>
</code></pre>
<p class="tx">返り値は<span class="thesansmonocd_w5regular_">Popen</span>オブジェクトで、<span class="thesansmonocd_w5regular_">poll()</span>と<span class="thesansmonocd_w5regular_">wait()</span>という2つの便利なメソッドがあります。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">poll()</span>メソッドは運転手に「目的地にもう着きましたか？」と到着するまで何度も聞くようなものです。<span class="thesansmonocd_w5regular_">poll()</span>が呼び出されたときにプロセスがまだ実行中であれば、<span class="thesansmonocd_w5regular_">poll()</span>メソッドは<span class="thesansmonocd_w5regular_">None</span>を返します。プログラムが終了していたら、そのプロセスの<i class="calibre5">終了コード</i>を整数で返します。終了コードはプロセスが正常に終了したかどうかを示します。正常終了であれば終了コードは<span class="thesansmonocd_w5regular_">0</span>で、エラーによりプロセスが終了すれば0以外です（<span class="thesansmonocd_w5regular_">1</span>のことが多いですがプログラムによって異なります）。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">wait()</span>メソッドは、運転手が目的地に到着するのを待つようなものです。起動したプロセスが終了するまでブロックします。ユーザーが別のプログラムでの処理を終えるまでプログラムを停止させたいときに便利です。<span class="thesansmonocd_w5regular_">wait()</span>の返り値は起動したプロセスの終了コードの整数です。</p>
<p class="tx">Windowsでは、対話型シェルで以下の内容を入力してください。<span class="thesansmonocd_w5regular_">wait()</span>を呼び出すと起動した電卓プログラムが終了するまでコード実行をブロックします。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">calc_proc = subprocess.Popen(['c:\\Windows\\System32\\calc.exe'])</b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> &gt;&gt;&gt; <b class="calibre10">calc_proc.poll() == None</b>
True
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> &gt;&gt;&gt; <b class="calibre10">calc_proc.wait() </b># 電卓が閉じられるまで返ってこない
0
&gt;&gt;&gt; <b class="calibre10">calc_proc.poll()</b>
0
</code></pre>
<p class="tx">電卓プロセスを開始します(<span class="codeannotation" aria-label="annotation1">❶</span>)。Windowsの古いバージョンでは、起動したプロセスが実行中であれば<span class="thesansmonocd_w5regular_">poll()</span>が<span class="thesansmonocd_w5regular_">None</span>を返します(<span class="codeannotation" aria-label="annotation2">❷</span>)。電卓アプリケーションのウィンドウを閉じてから対話型シェルに戻り、終了したプロセスについて<span class="thesansmonocd_w5regular_">wait()</span>を呼び出します(<span class="codeannotation" aria-label="annotation3">❸</span>)。<span class="thesansmonocd_w5regular_">wait()</span>と<span class="thesansmonocd_w5regular_">poll()</span>は、プロセスが正常に終了したことを示す<span class="thesansmonocd_w5regular_">0</span>を返します。</p>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1041" aria-label="472"></span>Windows10以降で<span class="thesansmonocd_w5regular_">subprocess.Popen()</span>により<i class="calibre5">calc.exe</i>を実行すると、電卓アプリが実行中であっても<span class="thesansmonocd_w5regular_">wait()</span>がすぐに返ってきます。<i class="calibre5">calc.exe</i>が電卓アプリを起動してすぐに終了するからです。Windowsの電卓プログラムは「信頼済みMicrosoft Storeアプリ」で、その詳細は本書の範囲外です。プログラムはアプリケーションやOSによって特有の実行のされ方をすることを覚えておいてください。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">subprocess.Popen()</span>で起動したプロセスを閉じたければ、その関数が返す<span class="thesansmonocd_w5regular_">Popen</span>オブジェクトの<span class="thesansmonocd_w5regular_">kill()</span>メソッドを呼び出します。WindowsのMS Paintをお持ちでしたら、対話型シェルで以下の内容を入力してみてください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">paint_proc = subprocess.Popen('c:\\Windows\\System32\\mspaint.exe')</b>
&gt;&gt;&gt; <b class="calibre10">paint_proc.kill()</b>
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">kill()</span>メソッドは、「本当にプログラムを終了しますか？」のような確認を経ずに即座にプログラムを終了させることに注意してください。そのプログラムでの保存していない作業はすべて失われます。</p>
<section type="division" aria-labelledby="sec13">
<h4 class="h1" id="calibre_link-1991"><span id="calibre_link-513"></span><span class="sans_futura_std_heavy_oblique_bi_">プロセスにコマンドライン引数を渡す</span></h4>
<p class="tni"><span class="thesansmonocd_w5regular_">run()</span>で作成したプロセスにコマンドライン引数を渡すことができます。<span class="thesansmonocd_w5regular_">run()</span>の唯一の引数であるリストでコマンドライン引数を渡します。このリストの最初の文字列は起動するプログラムの実行ファイルの名前で、それ以降の文字列は起動するプログラムのコマンドライン引数になります。起動したプログラムの<span class="thesansmonocd_w5regular_">sys.argv</span>の値になります。</p>
<p class="tx">GUIを持つアプリケーションはターミナルベースのプログラムほどコマンドライン引数を使いませんが、そのアプリケーションが起動したときに開くファイル名を引数に取るGUIアプリケーションは多くあります。例えば、Windowsで、<i class="calibre5">C:\Users\Al\hello.txt</i>という名前のテキストファイルを作成し、対話型シェルで以下の内容を入力してください。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">subprocess.run(['C:\\Windows\\notepad.exe', 'C:\\Users\Al\\hello.txt'])</b>
CompletedProcess(args=['C:\\Windows\\notepad.exe', 'C:\\Users\\Al\\hello.txt'], returncode=0)
</code></pre>
<p class="tx">メモ帳アプリケーションが<i class="calibre5">C:\Users\Al\hello.txt</i>ファイルを開きます。プログラムごとにコマンドライン引数が定められており、特にGUIアプリケーションではコマンドライン引数を一切取らないことも珍しくありません。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">subprocess.Popen()</span>関数もコマンドライン引数を同じように扱います。関数に渡すリストの末尾にコマンドライン引数を入れます。</p>
</section>
<section type="division" aria-labelledby="sec14">
<h4 class="h1" id="calibre_link-1992"><span id="calibre_link-514"></span><span class="sans_futura_std_heavy_oblique_bi_">起動したコマンドから出力テキストを受け取る</span></h4>
<p class="tni"><span class="thesansmonocd_w5regular_">subprocess.run()</span>と<span class="thesansmonocd_w5regular_">subprocess.Popen()</span>ではターミナルコマンドを起動することもできます。Pythonのコードで、起動したターミナルコマンドについて、出力テキストを受け取ったりキーボード入力を送信したりしたいことがあるかもしれません。例えば、Pythonから<span class="thesansmonocd_w5regular_">ping</span>コマンドを起動して、その出力テキストを受け取ってみましょう（<span class="thesansmonocd_w5regular_">ping</span>コマンドの詳細については本書の範囲外です）。Windowsでは、<span class="thesansmonocd_w5regular_">-n 4</span>引数をつけて、Nostarch.comのサーバーがオンラインであるかを確認するためにpingリクエストを4回送信します。macOSとLinuxでは、<span class="thesansmonocd_w5regular_">-n</span>ではなく<span class="thesansmonocd_w5regular_">-c</span>としてください。このコマンドは実行に数秒を要します。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">proc = subprocess.run(['ping', '-n', '4', 'nostarch.com'], capture_output=True, text=True)</b>
&gt;&gt;&gt; <b class="calibre10">print(proc.stdout)</b>
Pinging nostarch.com [104.20.120.46] with 32 bytes of data:
Reply from 104.20.120.46: bytes=32 time=19ms TTL=59
Reply from 104.20.120.46: bytes=32 time=17ms TTL=59
Reply from 104.20.120.46: bytes=32 time=97ms TTL=59
Reply from 104.20.120.46: bytes=32 time=217ms TTL=59

Ping statistics for 104.20.120.46:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 17ms, Maximum = 217ms, Average = 87ms
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">subprocess.run()</span>に<span class="thesansmonocd_w5regular_">capture_output=True</span>と<span class="thesansmonocd_w5regular_">text=True</span>の引数を渡すと、起動したプログラムの出力テキストが<span class="thesansmonocd_w5regular_">CompletedProcess</span>オブジェクトの<span class="thesansmonocd_w5regular_">stdout</span>（標準出力）属性に文字列として格納されます。Pythonスクリプトで他のプログラムの機能を活用してその出力テキストを文字列として利用できます。</p>
</section>
<section type="division" aria-labelledby="sec15">
<h4 class="h1" id="calibre_link-1993"><span id="calibre_link-515"></span><span class="sans_futura_std_heavy_oblique_bi_">タスクスケジューラ、launchd、cronの実行</span></h4>
<p class="tni">コンピュータに詳しい人なら、Windowsのタスクスケジューラ、macOSのlaunchd、Linuxのcronスケジューラのことをご存知かもしれません。資料が豊富で信頼できるこれらのツールを用いれば、指定した時間にアプリケーションが起動するようにスケジューリングできます。</p>
<p class="tx">OSに内蔵されているスケジューラを使えば、自分で時計を確認してスケジューリングするコードを書かなくてもすみます。ただし、プログラムを少し停止させたいだけなら、ループで<span class="thesansmonocd_w5regular_">time.sleep(1)</span>を呼び出して待機させたほうが簡単です。</p>
</section>
<section type="division" aria-labelledby="sec16">
<h4 class="h1" id="calibre_link-1994"><span id="calibre_link-516"></span><span class="sans_futura_std_heavy_oblique_bi_">デフォルトアプリケーションでファイルを開く</span></h4>
<p class="tni">お使いのコンピュータで<i class="calibre5">.txt</i>ファイルをダブルクリックすると、<i class="calibre5">.txt</i>ファイル拡張子と関連付けられたアプリケーションが自動的に起動します。各OSにはダブルクリックするのと同等のプログラムがあります。Windowsでは<span class="thesansmonocd_w5regular_">start</span>コマンドで、macOSとLinuxでは<span class="thesansmonocd_w5regular_">open</span>コマンドです。対話型シェルに以下の内容を入力し、お使いのOSに応じて<span class="thesansmonocd_w5regular_">run()</span>に<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1252" aria-label="474"></span><span class="thesansmonocd_w5regular_">'start'</span>または<span class="thesansmonocd_w5regular_">'open'</span>を渡してください。また、Windowsでは、以下のように<span class="thesansmonocd_w5regular_">shell=True</span>キーワード引数を渡します。</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">file_obj = open('hello.txt', 'w')  </b># hello.txtファイルの作成
&gt;&gt;&gt; <b class="calibre10">file_obj.write('Hello, world!')</b>
13
&gt;&gt;&gt; <b class="calibre10">file_obj.close()</b>
&gt;&gt;&gt; <b class="calibre10">import subprocess</b>
&gt;&gt;&gt; <b class="calibre10">subprocess.run(['</b><b class="calibre10"><var class="calibre20">start</var></b><b class="calibre10">', 'hello.txt'], shell=True)</b>
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">Hello, world!</span>を新しい<i class="calibre5">hello.txt</i>ファイルに書き込んでいます。それから、<span class="thesansmonocd_w5regular_">run()</span>を呼び出し、プログラム名（上の例ではWindowsの<span class="thesansmonocd_w5regular_">'start'</span>）とファイル名を含むリストを渡します。OSはそのファイルとの関連付けがわかるので、例えば、Windowsでは、<i class="calibre5">hello.txt</i>ファイルを扱う<i class="calibre5">Notepad.exe</i>を起動します。</p>
<p class="ph"><span id="calibre_link-517"></span><span class="sans_futura_std_heavy_b_">プロジェクト15：単純なカウントダウン</span></p>
<p class="tni">単純なストップウォッチアプリケーションを見つけるのが難しいのと同じように、単純なカウントダウンアプリケーションを見つけるのも難しいです。カウントダウンが終了したらアラームを鳴らすプログラムを書いてみましょう。</p>
<p class="tx">このプログラムには以下の内容が必要です。</p>
<ul class="ul">
<li class="bl">カウントダウンの数字を表示する間に<span class="thesansmonocd_w5regular_">time.sleep()</span>で1秒間停止する</li>
<li class="bl"><span class="thesansmonocd_w5regular_">subprocess.run()</span>で<i class="calibre5">alarm.wav</i>の音声ファイルをデフォルトアプリケーションで開く</li>
</ul>
<p class="tx">新しいファイルエディタタブを開いて<i class="calibre5">simplecountdown.py</i>という名前で保存してください。</p>
</section>
<section type="division" aria-labelledby="sec17">
<h4 class="h1" id="calibre_link-1995"><span id="calibre_link-518"></span><span class="sans_futura_std_heavy_oblique_bi_">ステップ1：カウントダウン</span></h4>
<p class="tni">このプログラムには、<span class="thesansmonocd_w5regular_">time.sleep()</span>関数のための<span class="thesansmonocd_w5regular_">time</span>モジュールと、<span class="thesansmonocd_w5regular_">subprocess.run()</span>関数のための<span class="thesansmonocd_w5regular_">subprocess</span>モジュールが必要です。以下のコードを<i class="calibre5">simplecountdown.py</i>ファイルに保存してください。</p>
<pre class="pre"><code class="calibre9"># https://autbor.com/simplecountdown.py - 単純なカウントダウンスクリプト

import time, subprocess

<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> time_left = 60
while time_left &gt; 0:
  <span class="code_codeannotation" aria-label="annotation2">❷</span> print(time_left)
  <span class="code_codeannotation" aria-label="annotation3">❸</span> time.sleep(1)
  <span class="code_codeannotation" aria-label="annotation4">❹</span> time_left = time_left - 1

# TODO：カウントダウンが終了したら音声ファイルを再生する
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">time</span>と<span class="thesansmonocd_w5regular_">subprocess</span>をインポートしてから、カウントダウンで残り秒数を保持する<span class="thesansmonocd_w5regular_">time_left</span>という名前の変数を作成します(<span class="codeannotation" aria-label="annotation1">❶</span>)。ここでは<span class="thesansmonocd_w5regular_">60</span>を設定していますが、好きな値に変更してください。コマンドライン引数から設定することもできます。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">while</span>ループでは、残り秒数を表示し(<span class="codeannotation" aria-label="annotation2">❷</span>)、1秒間停止して(<span class="codeannotation" aria-label="annotation3">❸</span>)、<span class="thesansmonocd_w5regular_">time_left</span>変数を1減らし(<span class="codeannotation" aria-label="annotation4">❹</span>)、ループを続けます。<span class="thesansmonocd_w5regular_">time_left</span>が<span class="thesansmonocd_w5regular_">0</span>より大きい間はループし続けます。<span class="thesansmonocd_w5regular_">0</span>になればカウントダウンが終わります。次に、音声ファイルを再生する<span class="thesansmonocd_w5regular_">TODO</span>コメントの部分のコードを書きます。</p>
</section>
<section type="division" aria-labelledby="sec18">
<h4 class="h1" id="calibre_link-1997"><span id="calibre_link-519"></span><span class="sans_futura_std_heavy_oblique_bi_">ステップ2：音声ファイルを再生する</span></h4>
<p class="tni"><span>第12章</span>でさまざまなフォーマットの音声を再生する<span class="thesansmonocd_w5regular_">playsound3</span>モジュールを紹介しましたが、ユーザーが音声を再生するのにすでに使っているアプリケーションを起動するのが一番簡単です。<i class="calibre5">.wav</i>ファイル拡張子からどのアプリケーションを起動して再生するかをOSに委ねます。<i class="calibre5">.wav</i>ファイルを<i class="calibre5">.mp3</i>や<i class="calibre5">.ogg</i>ファイル形式に差し替えることも簡単にできます。カウントダウンが終わったときに再生する音声ファイルは何でも構いません。<i class="calibre5"><a href="https://autbor.com/alarm.wav" class="calibre1">https://<wbr></wbr>autbor<wbr></wbr>.com<wbr></wbr>/alarm<wbr></wbr>.wav</a></i>から<i class="calibre5">alarm.wav</i>をダウンロードしてもよいです。</p>
<p class="tx">以下のコードを追加します。</p>
<pre class="pre"><code class="calibre9"># https://autbor.com/simplecountdown.py - 単純なカウントダウンスクリプト

<var class="calibre20">--snip--</var>

<b class="calibre10"># カウントダウンが終了したら音声ファイルを再生する</b>
<b class="calibre10">#subprocess.run(['start', 'alarm.wav'], shell=True)  # Windows</b>
<b class="calibre10">#subprocess.run(['open', 'alarm.wav'])  # macOSとLinux</b>
</code></pre>
<p class="tx"><span class="thesansmonocd_w5regular_">while</span>ループが終われば、<i class="calibre5">alarm.wav</i>（あるいはお選びの音声ファイル）が再生され、ユーザーにカウントダウンが終了したことを伝えます。お使いのOSに応じて<span class="thesansmonocd_w5regular_">subprocess.run()</span>の呼び出しのコメントを外してください。Windowsでは、<span class="thesansmonocd_w5regular_">run()</span>に渡すリストに<span class="thesansmonocd_w5regular_">'start'</span>を含めてください。macOSとLinuxでは、<span class="thesansmonocd_w5regular_">'start'</span>ではなく<span class="thesansmonocd_w5regular_">'open'</span>を渡し、<span class="thesansmonocd_w5regular_">shell=True</span>を取り除いてください。</p>
<p class="tx">音声ファイルを再生する代わりに<i class="calibre5">Break time!</i>のようなメッセージが書かれたテキストファイルをどこかに保存してカウントダウンが終了したときに<span class="thesansmonocd_w5regular_">subprocess.run()</span>で開くこともできます。これによりポップアップウィンドウでメッセージが表示されます。あるいは、カウントダウンが終了したときに、<span class="thesansmonocd_w5regular_">webbrowser.open()</span>関数で指定したウェブサイトを開くこともできます。オンラインで入手できる無料のカウントダウンアプリケーションとは異なり、自作のカウントダウンプログラムでは好きなようにカスタマイズできます。</p>
</section>
<section type="division" aria-labelledby="sec19">
<h4 class="h1"><span id="calibre_link-1998"></span><span id="calibre_link-520"></span><span class="sans_futura_std_heavy_oblique_bi_">似たようなプログラムのアイデア</span></h4>
<p class="tni">カウントダウンとは、プログラム実行を継続する前に遅延を生じさせることです。以下のようなアプリケーションや機能を同じアプローチで作成できます。</p>
<ul class="ul">
<li class="bl"><span class="thesansmonocd_w5regular_">time.sleep()</span>を使用した、ユーザーが<small class="calibre4">CTRL</small>-Cを押してファイル削除などの実行をキャンセルできる機能。“Press <small class="calibre4">CTRL</small>-C to cancel”のようなメッセージを表示して、<span class="thesansmonocd_w5regular_">try</span>文と<span class="thesansmonocd_w5regular_">except</span>文で<span class="thesansmonocd_w5regular_">KeyboardInterrupt</span>例外を処理します。</li>
<li class="bl"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1268" aria-label="476"></span>長い時間のカウントダウンには、<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを利用できます。将来のある時点（誕生日や記念日）までの日数、時間数、分数、秒数を設定できます。</li>
</ul>
</section>
</section>
<section type="conclusion" role="doc-conclusion" aria-labelledby="sec20">
<h3 class="h" id="calibre_link-1999"><span id="calibre_link-521"></span><span class="sans_futura_std_bold_b_">まとめ</span></h3>
<p class="tni">Unix時間（UTCでの1970年1月1日午前0時0分0秒）はPythonを含む多くのプログラミング言語で参照する標準時間です。<span class="thesansmonocd_w5regular_">time.time()</span>関数はエポック秒（Unix時間からの経過秒数を表す浮動小数点数値）を返します。日時の計算や表示の調整や文字列の解析には、<span class="thesansmonocd_w5regular_">datetime</span>モジュールを使ったほうが便利です。</p>
<p class="tx"><span class="thesansmonocd_w5regular_">time.sleep()</span>関数は指定秒数だけコード実行をブロックします。プログラムを停止させるのに使えます。ただし、プログラムを指定日時に実行させるなら、<i class="calibre5"><a href="https://nostarch.com/automate-boring-stuff-python-3rd-edition" class="calibre1">https://<wbr></wbr>nostarch<wbr></wbr>.com<wbr></wbr>/automate<wbr></wbr>-boring<wbr></wbr>-stuff<wbr></wbr>-python<wbr></wbr>-3rd<wbr></wbr>-edition</a></i>の説明を読み、お使いのOSに内蔵されているスケジューラを使ってください。</p>
<p class="tx">自分が書いたPythonプログラムから<span class="thesansmonocd_w5regular_">subprocess.run()</span>関数で別のアプリケーションを起動できます。コマンドライン引数を<span class="thesansmonocd_w5regular_">run()</span>呼び出しに渡してそのアプリケーションで開くファイルを指定できます。あるいは、<span class="thesansmonocd_w5regular_">run()</span>で<span class="thesansmonocd_w5regular_">start</span>または<span class="thesansmonocd_w5regular_">open</span>プログラムを使って、ファイルの関連付けによりファイルを開くアプリケーションを自動的に起動することもできます。コンピュータ上の別のアプリケーションを利用することで、Pythonプログラムは自動化に必要な機能を拡張することができます。</p>
</section>
<section type="division" aria-labelledby="sec21">
<h3 class="h" id="calibre_link-2000"><span id="calibre_link-522"></span><span class="sans_futura_std_bold_b_">練習問題</span></h3>
<p class="listnumber">  1. Unix時間とは何ですか？</p>
<p class="listnumber">  2. Unix時間からの経過秒数を返す関数は何ですか？</p>
<p class="listnumber">  3. 現在時刻について、<span class="thesansmonocd_w5regular_">'Mon Jun 15 14:00:38 2026'</span>のような人間が読みやすい文字列を返す<span class="thesansmonocd_w5regular_">time</span>モジュールの関数は何ですか？</p>
<p class="listnumber">  4. 5秒間プログラムを停止させるにはどうしますか？</p>
<p class="listnumber">  5. <span class="thesansmonocd_w5regular_">round()</span>関数は何を返しますか？</p>
<p class="listnumber">  6. <span class="thesansmonocd_w5regular_">datetime</span>オブジェクトと<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトの違いは何ですか？</p>
<p class="listnumber">  7. <span class="thesansmonocd_w5regular_">datetime</span>モジュールを使って、2019年1月7日の曜日を調べてください。</p>
</section>
<section type="division" aria-labelledby="sec22">
<h3 class="h" id="calibre_link-2001"><span id="calibre_link-523"></span><span class="sans_futura_std_bold_b_">練習プログラム</span></h3>
<p class="tni">以下の練習プログラムを書いてください。</p>
<section type="division" aria-labelledby="sec23">
<h4 class="h1" id="calibre_link-2002"><span id="calibre_link-524"></span><span class="sans_futura_std_heavy_oblique_bi_">ストップウォッチの表示調整</span></h4>
<p class="tni">本章のストップウォッチプロジェクトの拡張で、<span class="thesansmonocd_w5regular_">rjust()</span>メソッドと<span class="thesansmonocd_w5regular_">ljust()</span>メソッドを使って出力をきれいにしてください（これらのメソッドは<span>第8章</span>で紹介しました）。以下のような出力から</p>
<pre class="pre"><code class="calibre9"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1169" aria-label="477"></span>Lap #1: 3.56 (3.56)
Lap #2: 8.63 (5.07)
Lap #3: 17.68 (9.05)
Lap #4: 19.11 (1.43)
</code></pre>
<p class="tni">以下のような出力へと調整します。</p>
<pre class="pre"><code class="calibre9">Lap # 1:   3.56 (  3.56)
Lap # 2:   8.63 (  5.07)
Lap # 3:  17.68 (  9.05)
Lap # 4:  19.11 (  1.43)
</code></pre>
<p class="tx">次に、<span>第8章</span>で紹介した<span class="thesansmonocd_w5regular_">pyperclip</span>モジュールを使い、出力テキストをクリップボードにコピーして、テキストファイルやメールに素早く貼り付けられるようにしてください。</p>
</section>
<section type="division" aria-labelledby="sec24">
<h4 class="h1" id="calibre_link-2003"><span id="calibre_link-525"></span><span class="sans_futura_std_heavy_oblique_bi_">13日の金曜日発見器</span></h4>
<p class="tni">13日の金曜日は不吉だと考えられています（私は個人的に吉兆だと考えています）。うるう年や月の日数の変動から、次の13日の金曜日がいつになるかを判断するのは難しいです。</p>
<p class="tx">2つのプログラムを書きます。1つ目のプログラムでは、現在の日付の<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトと、1日間の<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを作成します。現在の日付が13日の金曜日なら、その月と年を表示します。次に、<span class="thesansmonocd_w5regular_">datetime</span>オブジェクトに<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを足して次の日を設定し、13日の金曜日かどうかまたチェックします。次の13日の金曜日を見つけるまでこれを繰り返します。</p>
<p class="tx">2つ目のプログラムは、<span class="thesansmonocd_w5regular_">timedelta</span>オブジェクトを足すのではなく引くという点を除き、1つ目のプログラムと同じです。このプログラムは、西暦1年まで遡り、過去の13日の金曜日をすべて発見します。</p>
</section>
</section>
</section>
</div>



</div>



</body></html>